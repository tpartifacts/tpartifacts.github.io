(this["webpackJsonptaqwa-prayer"]=this["webpackJsonptaqwa-prayer"]||[]).push([[1],{135:function(e,t,a){},136:function(e,t,a){},141:function(e,t,a){"use strict";a.r(t);var n=a(31),r=a(22),l=a(3),c=a(0),u=a.n(c),i=a(117),o=a.n(i),m=a(2),s=a.n(m),d=a(30),h=a(20),f=a(35),p=a(16),b=a(28),E=a(5),g=(a(135),Object(f.b)("signin")((function(e){var t=e.signin,a=e.meta,i=Object(c.useState)({uname:"",pwd:""}),o=Object(l.a)(i,2),m=o[0],s=o[1],h=Object(c.useState)(null),f=Object(l.a)(h,2),p=f[0],b=f[1],E=Object(c.useState)(!1),g=Object(l.a)(E,2),j=g[0],O=g[1],v=function(e){s(Object(r.a)(Object(r.a)({},m),{},Object(n.a)({},e.target.name,e.target.value)))};return u.a.createElement("div",null,u.a.createElement("form",{className:"login-form"},u.a.createElement("h1",null,"Login"),p&&u.a.createElement("div",{className:"login-form__error"},p),j&&u.a.createElement(d.a,null),u.a.createElement("input",{type:"text",name:"uname",className:"login-form__input-item",placeholder:"Username",value:m.uname,onChange:v}),u.a.createElement("br",null),u.a.createElement("br",null),u.a.createElement("input",{type:"password",name:"pwd",className:"login-form__input-item",placeholder:"Password",value:m.pwd,onChange:v}),u.a.createElement("br",null),u.a.createElement("br",null),u.a.createElement("input",{type:"submit",className:"login-form__input-button",value:"Sign in",onClick:function(e){e.preventDefault(),O(!0),t("taqwa-prayer-".concat(m.uname,"@amrayn.com"),m.pwd).catch((function(e){O(!1),b("Unable to login, please check the username/password before trying again.")}))}})),a&&u.a.createElement("div",{className:"login-form__footer"},"If you do not have the credentials, please contact brothers on ",a.EMAIL," or ",a.PHONE))}))),j=(a(136),function(e){return u.a.createElement("input",{required:!0,type:"time",value:e.time,name:e.name,className:"t",onChange:e.handler})});t.default=Object(f.b)("currentUser","signout","statusPending")((function(e){var t=Object(c.useState)({}),a=Object(l.a)(t,2),i=a[0],m=a[1],f=Object(c.useState)(!0),O=Object(l.a)(f,2),v=O[0],y=O[1],S=Object(c.useState)(null),N=Object(l.a)(S,2),T=N[0],w=N[1],D=Object(c.useState)(null),I=Object(l.a)(D,2),U=I[0],M=I[1],P=Object(c.useState)(null),_=Object(l.a)(P,2),Y=_[0],k=_[1],A=Object(c.useState)(null),C=Object(l.a)(A,2),q=C[0],x=C[1],B=Object(c.useState)(null),F=Object(l.a)(B,2),z=F[0],J=F[1],L=Object(c.useState)(null),R=Object(l.a)(L,2),V=R[0],G=R[1],H=Object(c.useState)(null),W=Object(l.a)(H,2),K=W[0],Q=W[1],X=Object(c.useState)(null),Z=Object(l.a)(X,2),$=Z[0],ee=Z[1],te=Object(b.a)("dev",0,-1);Object(c.useEffect)((function(){localStorage.setItem("cache-breaker",Math.random()),te&&console.log("Development mode")}),[te]),Object(c.useEffect)((function(){fetch(h.a.META_ENDPOINT+E.g).then((function(e){return e.json()})).then((function(e){var t=s()(e[E.g],"DD-MMM-YYYY").diff(s()(),"days");G(t),Q(s.a.duration(t,"days").humanize(!0))}))}),[]),Object(c.useEffect)((function(){if(e.currentUser){if(V<=-35)if(localStorage.getItem("adhaan-builder-running")){ee("Already updating ...");var t=localStorage.getItem("adhaan-builder-running");((new Date).getTime()-new Date(Number(t)))/1e3>=3600&&(console.log("Adhaan build started more than an hour ago, resetting!"),localStorage.removeItem("adhaan-builder-running"),ee("Finished updating!"))}else ee("Updating ..."),localStorage.setItem("adhaan-builder-running",(new Date).getTime()),e.currentUser.getIdToken(!0).then((function(e){fetch("/api/v1/adhaan/build?offset=0&count=2&forceUpdate=false",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(){ee("Update successful. Running housekeeper..."),fetch("/api/v1/adhaan/housekeeper",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(){localStorage.removeItem("adhaan-builder-running"),ee("It has just been updated!")}))})).catch((function(){ee("Failed to update - please update manually!")}))}));else ee("Up-to-date")}}),[V,e.currentUser]),Object(c.useEffect)((function(){if(e.ready){var t=s()(e.upcomingTimes.effective,E.d);t.startOf("day").isBefore(s()().startOf("day"))&&(t=s()().startOf("day"));var a={times:{fajr:Object(p.d)(e.upcomingTimes.fajr),dhuhr:Object(p.d)(e.upcomingTimes.dhuhr),asr:Object(p.d)(e.upcomingTimes.asr),ishaa:Object(p.d)(e.upcomingTimes.ishaa),jumuah:Object(p.d)(e.upcomingTimes.jumuah)},upcomingEffectiveDate:t.format("YYYY-MM-DD")};m({fajr:a.times.fajr,dhuhr:a.times.dhuhr,asr:a.times.asr,ishaa:a.times.ishaa,jumuah:a.times.jumuah}),k(a.upcomingEffectiveDate),x(s()().startOf("day").format("YYYY-MM-DD")),J(s()().startOf("day").add(7,"day").format("YYYY-MM-DD")),y(!1)}}),[e.ready,e.upcomingTimes]);var ae=function(e){e.preventDefault(),m(Object(r.a)(Object(r.a)({},i),{},Object(n.a)({},e.target.name,e.target.value)))};return u.a.createElement(o.a,{id:"pa-edit",className:"pa-edit",meta:{title:"Edit Prayer Times",viewport:"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"}},(!e.currentUser&&e.statusPending||v)&&u.a.createElement(d.a,null),!e.currentUser&&!e.statusPending&&u.a.createElement(g,e),e.currentUser&&!e.statusPending&&u.a.createElement(u.a.Fragment,null,u.a.createElement("h1",null,"Edit Iqaamah Times"),v&&u.a.createElement("div",{className:"pending"},"Loading..."),T&&u.a.createElement("div",{className:"error"},T),U&&u.a.createElement("div",{className:"message"},U),u.a.createElement("form",{onSubmit:function(t){t.preventDefault(),y(!0);var a=s()().startOf("day"),n=s()(Y,E.d).isSameOrBefore(a),l=n?h.a.SAVE_ENDPOINT_CURR:h.a.SAVE_ENDPOINT_UPCOMING+(te?"&dev=true&":""),c=JSON.stringify(Object(r.a)(Object(r.a)({},i),{},{effective:Y}));e.currentUser.getIdToken(!0).then((function(e){fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:c}).then((function(e){return y(n),e})).then((function(e){return e.json()})).then((function(t){t.error?w(t.error):n?fetch(h.a.SAVE_ENDPOINT_UPCOMING,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:c}).then((function(e){return y(!1),localStorage.setItem("cache-breaker",Math.random()),e})).then((function(e){return e.json()})).then((function(e){e.error?w(e.error):M(e.message)})):(localStorage.setItem("cache-breaker",Math.random()),M(t.message))})).catch((function(e){w("Unexpected error occurred")}))}))}},u.a.createElement("table",null,u.a.createElement("tbody",null,u.a.createElement("tr",null,u.a.createElement("td",null,"Fajr"),u.a.createElement("td",null,u.a.createElement(j,{name:"fajr",time:i.fajr,handler:ae}))),u.a.createElement("tr",null,u.a.createElement("td",null,"Dhuhr"),u.a.createElement("td",null,u.a.createElement(j,{name:"dhuhr",time:i.dhuhr,handler:ae}))),u.a.createElement("tr",null,u.a.createElement("td",null,"Asr"),u.a.createElement("td",null,u.a.createElement(j,{name:"asr",time:i.asr,handler:ae}))),u.a.createElement("tr",null,u.a.createElement("td",null,"Ishaa"),u.a.createElement("td",null,u.a.createElement(j,{name:"ishaa",time:i.ishaa,handler:ae}))),u.a.createElement("tr",null,u.a.createElement("td",null,"Jumuah"),u.a.createElement("td",null,u.a.createElement(j,{name:"jumuah",time:i.jumuah,handler:ae}))),u.a.createElement("tr",null),u.a.createElement("tr",null,u.a.createElement("td",null,"Effective from"),u.a.createElement("td",null,u.a.createElement("input",{type:"date",id:"effective",name:"effective",className:"t",value:Y,min:q,max:z,required:!0,onChange:function(e){k(e.target.value)}}))),u.a.createElement("tr",{className:"button-container"},u.a.createElement("td",{colSpan:"2"},u.a.createElement("input",{type:"submit",className:"button",value:"Save",disabled:v}))),u.a.createElement("tr",{className:"button-container"},u.a.createElement("td",{colSpan:"2"},u.a.createElement("input",{type:"button",className:"button",value:"Cancel",onClick:function(e){e.preventDefault(),window.location="/"}}))),u.a.createElement("tr",{className:"button-container"},u.a.createElement("td",{colSpan:"2"},u.a.createElement("input",{type:"button",className:"button",value:"Sign Out",onClick:function(t){t.preventDefault(),e.signout()}})))))),u.a.createElement("div",{className:"note"},"Maghrib iqaamah time is 10 (+",E.e," min offset) minutes after adhaan"),u.a.createElement("hr",null),u.a.createElement("h2",null,"Adhaan"),V<=-1&&u.a.createElement(u.a.Fragment,null,u.a.createElement("div",null,"The adhaan data is fetched and built off timeanddate.com which requires us to store the data for at least 2 months for this app to work correctly. Adhaan data was last updated ",u.a.createElement("b",null,K),"."),u.a.createElement("div",null,"This page automatically tries to keep the adhaan data up-to-date. This operation is recurring on monthly basis. If you experience anything unexpected, please try again in few minutes especially when the data is being updated (see status below)."),u.a.createElement("br",null)),V>0&&u.a.createElement(u.a.Fragment,null,u.a.createElement("div",null,V," days worth of data available. We are good, Alhamdullilah.")),u.a.createElement("b",null,"Status: ",$)))}))}}]);